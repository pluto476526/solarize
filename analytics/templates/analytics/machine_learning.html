{% extends 'analytics/main.html' %}
{% load static %}
{% block main %}
    <!-- Content Start -->
    <div class="content">
        <!-- Navbar Start -->
        {% include 'analytics/nav.html' %}
        <!-- Navbar End -->
        <!-- Machine Learning Dashboard Start -->
        <div class="container-fluid pt-4 px-4">
            <!-- ML Process Header -->
            <div class="row g-4">
                <div class="col-12">
                    <div class="bg-secondary rounded p-4">
                        <div class="d-flex align-items-center justify-content-between mb-4">
                            <h4 class="mb-0">Machine Learning Model Training & Prediction</h4>
                            <span class="badge bg-warning">LightGBM Active</span>
                        </div>
                        <div class="row">
                            <div class="col-md-3">
                                <div class="text-center p-3 border rounded bg-dark">
                                    <i class="fas fa-brain fa-2x text-info mb-2"></i>
                                    <h6 class="mb-1">Model Status</h6>
                                    <span class="badge bg-success">Trained</span>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="text-center p-3 border rounded bg-dark">
                                    <i class="fas fa-chart-line fa-2x text-warning mb-2"></i>
                                    <h6 class="mb-1">Accuracy Score</h6>
                                    <span class="badge bg-primary">94.2%</span>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="text-center p-3 border rounded bg-dark">
                                    <i class="fas fa-database fa-2x text-success mb-2"></i>
                                    <h6 class="mb-1">Training Data</h6>
                                    <span class="badge bg-info">12,540 samples</span>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="text-center p-3 border rounded bg-dark">
                                    <i class="fas fa-clock fa-2x text-secondary mb-2"></i>
                                    <h6 class="mb-1">Last Training</h6>
                                    <span class="badge bg-dark">2 hours ago</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Model Training Section -->
            <div class="row g-4 mt-2">
                <div class="col-lg-8">
                    <div class="bg-secondary rounded p-4">
                        <h5 class="mb-4">Model Training Configuration</h5>
                        <!-- Training Parameters Form -->
                        <form id="mlTrainingForm">
                            <div class="row g-3">
                                <!-- LightGBM Parameters -->
                                <div class="col-md-6">
                                    <h6 class="text-warning mb-3">LightGBM Parameters</h6>
                                    <div class="mb-3">
                                        <label for="n_estimators" class="form-label">Number of Estimators</label>
                                        <input type="number"
                                               class="form-control"
                                               id="n_estimators"
                                               value="300"
                                               min="100"
                                               max="1000">
                                        <div class="form-text">Number of boosting iterations (100-1000)</div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="learning_rate" class="form-label">Learning Rate</label>
                                        <input type="number"
                                               class="form-control"
                                               id="learning_rate"
                                               value="0.05"
                                               step="0.01"
                                               min="0.01"
                                               max="0.3">
                                        <div class="form-text">Shrinks the contribution of each tree (0.01-0.3)</div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="num_leaves" class="form-label">Number of Leaves</label>
                                        <input type="number"
                                               class="form-control"
                                               id="num_leaves"
                                               value="63"
                                               min="31"
                                               max="127">
                                        <div class="form-text">Maximum tree leaves for base learners (31-127)</div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <h6 class="text-warning mb-3">Advanced Parameters</h6>
                                    <div class="mb-3">
                                        <label for="max_depth" class="form-label">Max Depth</label>
                                        <input type="number"
                                               class="form-control"
                                               id="max_depth"
                                               value="-1"
                                               min="-1"
                                               max="20">
                                        <div class="form-text">-1 for no limit, or set maximum tree depth</div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="min_child_samples" class="form-label">Min Child Samples</label>
                                        <input type="number"
                                               class="form-control"
                                               id="min_child_samples"
                                               value="20"
                                               min="1"
                                               max="100">
                                        <div class="form-text">Minimum number of data needed in a leaf</div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="subsample" class="form-label">Subsample</label>
                                        <input type="number"
                                               class="form-control"
                                               id="subsample"
                                               value="1.0"
                                               step="0.1"
                                               min="0.1"
                                               max="1.0">
                                        <div class="form-text">Subsample ratio of the training instance</div>
                                    </div>
                                </div>
                            </div>
                            <!-- Feature Selection -->
                            <div class="row mt-3">
                                <div class="col-12">
                                    <h6 class="text-warning mb-3">Feature Selection</h6>
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="feature_temp" checked>
                                                <label class="form-check-label" for="feature_temp">Temperature</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input"
                                                       type="checkbox"
                                                       id="feature_humidity"
                                                       checked>
                                                <label class="form-check-label" for="feature_humidity">Humidity</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input"
                                                       type="checkbox"
                                                       id="feature_cloud_cover"
                                                       checked>
                                                <label class="form-check-label" for="feature_cloud_cover">Cloud Cover</label>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-check">
                                                <input class="form-check-input"
                                                       type="checkbox"
                                                       id="feature_wind_speed"
                                                       checked>
                                                <label class="form-check-label" for="feature_wind_speed">Wind Speed</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input"
                                                       type="checkbox"
                                                       id="feature_sun_elevation"
                                                       checked>
                                                <label class="form-check-label" for="feature_sun_elevation">Sun Elevation</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input"
                                                       type="checkbox"
                                                       id="feature_sun_azimuth"
                                                       checked>
                                                <label class="form-check-label" for="feature_sun_azimuth">Sun Azimuth</label>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="feature_hour" checked>
                                                <label class="form-check-label" for="feature_hour">Hour of Day</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input"
                                                       type="checkbox"
                                                       id="feature_dayofyear"
                                                       checked>
                                                <label class="form-check-label" for="feature_dayofyear">Day of Year</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="feature_month" checked>
                                                <label class="form-check-label" for="feature_month">Month</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Training Actions -->
                            <div class="row mt-4">
                                <div class="col-12">
                                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                        <button type="button" class="btn btn-secondary me-md-2" id="btnResetParams">
                                            <i class="fas fa-undo me-2"></i>Reset to Defaults
                                        </button>
                                        <button type="submit" class="btn btn-warning" id="btnTrainModel">
                                            <i class="fas fa-graduation-cap me-2"></i>Train Model
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
                <!-- Training Progress & Metrics -->
                <div class="col-lg-4">
                    <div class="bg-secondary rounded p-4 h-100">
                        <h5 class="mb-4">Training Progress & Metrics</h5>
                        <!-- Training Status -->
                        <div class="mb-4">
                            <h6 class="text-info">Training Status</h6>
                            <div class="progress mb-2" style="height: 20px;">
                                <div class="progress-bar bg-success progress-bar-striped progress-bar-animated"
                                     role="progressbar"
                                     style="width: 100%"
                                     id="trainingProgress">Complete</div>
                            </div>
                            <small class="text-muted" id="trainingStatus">Model trained and ready for predictions</small>
                        </div>
                        <!-- Model Metrics -->
                        <div class="mb-4">
                            <h6 class="text-info">Model Performance</h6>
                            <div class="row text-center">
                                <div class="col-6 mb-3">
                                    <div class="border rounded p-2 bg-dark">
                                        <div class="text-warning fw-bold">94.2%</div>
                                        <small>Accuracy Score</small>
                                    </div>
                                </div>
                                <div class="col-6 mb-3">
                                    <div class="border rounded p-2 bg-dark">
                                        <div class="text-info fw-bold">0.042</div>
                                        <small>Mean Absolute Error</small>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="border rounded p-2 bg-dark">
                                        <div class="text-success fw-bold">0.967</div>
                                        <small>R² Score</small>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="border rounded p-2 bg-dark">
                                        <div class="text-primary fw-bold">2.3s</div>
                                        <small>Training Time</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Feature Importance -->
                        <div>
                            <h6 class="text-info">Top Feature Importance</h6>
                            <div class="list-group">
                                <div class="list-group-item bg-dark d-flex justify-content-between align-items-center">
                                    Sun Elevation
                                    <span class="badge bg-primary rounded-pill">24.5%</span>
                                </div>
                                <div class="list-group-item bg-dark d-flex justify-content-between align-items-center">
                                    Cloud Cover
                                    <span class="badge bg-primary rounded-pill">18.2%</span>
                                </div>
                                <div class="list-group-item bg-dark d-flex justify-content-between align-items-center">
                                    Temperature
                                    <span class="badge bg-primary rounded-pill">15.7%</span>
                                </div>
                                <div class="list-group-item bg-dark d-flex justify-content-between align-items-center">
                                    Hour of Day
                                    <span class="badge bg-primary rounded-pill">12.3%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Prediction Interface -->
            <div class="row g-4 mt-2">
                <div class="col-lg-6">
                    <div class="bg-secondary rounded p-4">
                        <h5 class="mb-4">Solar Production Prediction</h5>
                        <!-- Prediction Input Form -->
                        <form id="predictionForm">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="prediction_location" class="form-label">Location</label>
                                        <select class="form-select" id="prediction_location" required>
                                            <option value="">Select location...</option>
                                            {% for location in locations %}<option value="{{ location.id }}">{{ location.name }}</option>{% endfor %}
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="prediction_date" class="form-label">Date</label>
                                        <input type="date" class="form-control" id="prediction_date" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="prediction_time" class="form-label">Time</label>
                                        <input type="time" class="form-control" id="prediction_time" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="prediction_temperature" class="form-label">Temperature (°C)</label>
                                        <input type="number"
                                               class="form-control"
                                               id="prediction_temperature"
                                               step="0.1"
                                               required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="prediction_cloud_cover" class="form-label">Cloud Cover (%)</label>
                                        <input type="range"
                                               class="form-range"
                                               id="prediction_cloud_cover"
                                               min="0"
                                               max="100"
                                               value="30">
                                        <div class="d-flex justify-content-between">
                                            <small>0%</small>
                                            <small id="cloudCoverValue">30%</small>
                                            <small>100%</small>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="prediction_humidity" class="form-label">Humidity (%)</label>
                                        <input type="range"
                                               class="form-range"
                                               id="prediction_humidity"
                                               min="0"
                                               max="100"
                                               value="60">
                                        <div class="d-flex justify-content-between">
                                            <small>0%</small>
                                            <small id="humidityValue">60%</small>
                                            <small>100%</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row mt-3">
                                <div class="col-12">
                                    <div class="d-grid">
                                        <button type="submit" class="btn btn-success btn-lg">
                                            <i class="fas fa-bolt me-2"></i>Generate Prediction
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
                <!-- Prediction Results -->
                <div class="col-lg-6">
                    <div class="bg-secondary rounded p-4 h-100">
                        <h5 class="mb-4">Prediction Results</h5>
                        <!-- Results Display -->
                        <div id="predictionResults">
                            <div class="text-center py-5">
                                <i class="fas fa-chart-bar fa-3x text-muted mb-3"></i>
                                <p class="text-muted">Submit prediction parameters to see results</p>
                            </div>
                        </div>
                        <!-- Results Template (Hidden) -->
                        <div id="resultsTemplate" class="d-none">
                            <div class="row text-center mb-4">
                                <div class="col-6">
                                    <div class="border rounded p-3 bg-dark">
                                        <h4 class="text-warning mb-1" id="resultEnergy">0.0</h4>
                                        <small>Predicted Energy (kWh)</small>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="border rounded p-3 bg-dark">
                                        <h4 class="text-info mb-1" id="resultConfidence">0%</h4>
                                        <small>Confidence Level</small>
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <h6 class="text-info">Method Comparison</h6>
                                <div class="table-responsive">
                                    <table class="table table-sm table-dark">
                                        <thead>
                                            <tr>
                                                <th>Method</th>
                                                <th>Prediction</th>
                                                <th>Variance</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>PVWatts Only</td>
                                                <td id="pvwattsPred">0.0 kWh</td>
                                                <td id="pvwattsVar">±0.0%</td>
                                            </tr>
                                            <tr>
                                                <td>ML Only</td>
                                                <td id="mlPred">0.0 kWh</td>
                                                <td id="mlVar">±0.0%</td>
                                            </tr>
                                            <tr class="table-warning">
                                                <td>
                                                    <strong>Hybrid</strong>
                                                </td>
                                                <td id="hybridPred">
                                                    <strong>0.0 kWh</strong>
                                                </td>
                                                <td id="hybridVar">
                                                    <strong>±0.0%</strong>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="alert alert-info">
                                <small>
                                    <i class="fas fa-lightbulb me-2"></i>
                                    <span id="insightText">Prediction insights will appear here</span>
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Model Comparison & Analysis -->
            <div class="row g-4 mt-2">
                <div class="col-12">
                    <div class="bg-secondary rounded p-4">
                        <h5 class="mb-4">Model Performance Analysis</h5>
                        <div class="row">
                            <!-- Model Comparison Charts -->
                            <div class="col-md-8">
                                <div class="bg-dark rounded p-3">
                                    <h6 class="text-warning mb-3">Prediction vs Actual Comparison</h6>
                                    <div id="modelComparisonChart" style="height: 300px;">
                                        <!-- Plotly chart will be rendered here -->
                                        <div class="text-center py-5 text-muted">
                                            <i class="fas fa-chart-line fa-2x mb-2"></i>
                                            <p>Model comparison chart loading...</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Model Statistics -->
                            <div class="col-md-4">
                                <div class="bg-dark rounded p-3 h-100">
                                    <h6 class="text-warning mb-3">Model Statistics</h6>
                                    <div class="list-group">
                                        <div class="list-group-item bg-secondary d-flex justify-content-between align-items-center">
                                            Training Duration
                                            <span class="badge bg-primary">2.3 seconds</span>
                                        </div>
                                        <div class="list-group-item bg-secondary d-flex justify-content-between align-items-center">
                                            Dataset Size
                                            <span class="badge bg-info">12,540 samples</span>
                                        </div>
                                        <div class="list-group-item bg-secondary d-flex justify-content-between align-items-center">
                                            Feature Count
                                            <span class="badge bg-success">12 features</span>
                                        </div>
                                        <div class="list-group-item bg-secondary d-flex justify-content-between align-items-center">
                                            Cross-Validation Score
                                            <span class="badge bg-warning">0.941</span>
                                        </div>
                                        <div class="list-group-item bg-secondary d-flex justify-content-between align-items-center">
                                            Last Updated
                                            <span class="badge bg-secondary">2 hours ago</span>
                                        </div>
                                    </div>
                                    <div class="mt-3">
                                        <button class="btn btn-outline-warning btn-sm w-100 mb-2">
                                            <i class="fas fa-download me-2"></i>Export Model
                                        </button>
                                        <button class="btn btn-outline-info btn-sm w-100">
                                            <i class="fas fa-chart-bar me-2"></i>Detailed Report
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Batch Prediction Section -->
            <div class="row g-4 mt-2">
                <div class="col-12">
                    <div class="bg-secondary rounded p-4">
                        <h5 class="mb-4">Batch Prediction & Analysis</h5>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="bg-dark rounded p-4 h-100">
                                    <h6 class="text-warning mb-3">Upload Prediction Data</h6>
                                    <form id="batchPredictionForm">
                                        <div class="mb-3">
                                            <label for="batchFile" class="form-label">CSV Data File</label>
                                            <input class="form-control" type="file" id="batchFile" accept=".csv">
                                            <div class="form-text">Upload CSV with environmental data for batch predictions</div>
                                        </div>
                                        <div class="mb-3">
                                            <label for="predictionHorizon" class="form-label">Prediction Horizon</label>
                                            <select class="form-select" id="predictionHorizon">
                                                <option value="24h">24 Hours</option>
                                                <option value="7d">7 Days</option>
                                                <option value="1m">1 Month</option>
                                            </select>
                                        </div>
                                        <div class="d-grid">
                                            <button type="submit" class="btn btn-primary">
                                                <i class="fas fa-play me-2"></i>Run Batch Prediction
                                            </button>
                                        </div>
                                    </form>
                                    <div class="mt-4">
                                        <h6 class="text-info">Expected CSV Format</h6>
                                        <div class="bg-secondary p-2 rounded">
                                            <code class="small">
                                                timestamp,temperature,humidity,cloud_cover,wind_speed
                                                <br>
                                                2024-01-01 06:00:00,18.5,65,20,3.2
                                                <br>
                                                2024-01-01 07:00:00,20.1,60,15,2.8
                                                <br>
                                                ...
                                            </code>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-8">
                                <div class="bg-dark rounded p-4 h-100">
                                    <h6 class="text-warning mb-3">Batch Prediction Results</h6>
                                    <div id="batchResults">
                                        <div class="text-center py-5 text-muted">
                                            <i class="fas fa-table fa-2x mb-2"></i>
                                            <p>Upload a CSV file to generate batch predictions</p>
                                        </div>
                                    </div>
                                    <!-- Results Table Template -->
                                    <div id="batchResultsTemplate" class="d-none">
                                        <div class="table-responsive">
                                            <table class="table table-sm table-dark">
                                                <thead>
                                                    <tr>
                                                        <th>Timestamp</th>
                                                        <th>PVWatts</th>
                                                        <th>ML Prediction</th>
                                                        <th>Hybrid</th>
                                                        <th>Confidence</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="batchResultsBody">
                                                    <!-- Rows will be populated by JavaScript -->
                                                </tbody>
                                            </table>
                                        </div>
                                        <div class="mt-3">
                                            <button class="btn btn-success btn-sm">
                                                <i class="fas fa-download me-2"></i>Download Results
                                            </button>
                                            <button class="btn btn-info btn-sm ms-2">
                                                <i class="fas fa-chart-line me-2"></i>Visualize Results
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Machine Learning Dashboard End -->
        <script>
    // JavaScript for ML Dashboard functionality
    document.addEventListener('DOMContentLoaded', function() {
        // Cloud cover and humidity range displays
        const cloudCoverSlider = document.getElementById('prediction_cloud_cover');
        const humiditySlider = document.getElementById('prediction_humidity');
        const cloudCoverValue = document.getElementById('cloudCoverValue');
        const humidityValue = document.getElementById('humidityValue');
        
        cloudCoverSlider.addEventListener('input', function() {
            cloudCoverValue.textContent = this.value + '%';
        });
        
        humiditySlider.addEventListener('input', function() {
            humidityValue.textContent = this.value + '%';
        });
        
        // Reset parameters button
        document.getElementById('btnResetParams').addEventListener('click', function() {
            document.getElementById('n_estimators').value = 300;
            document.getElementById('learning_rate').value = 0.05;
            document.getElementById('num_leaves').value = 63;
            document.getElementById('max_depth').value = -1;
            document.getElementById('min_child_samples').value = 20;
            document.getElementById('subsample').value = 1.0;
        });
        
        // Training form submission
        document.getElementById('mlTrainingForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const btn = document.getElementById('btnTrainModel');
            const progress = document.getElementById('trainingProgress');
            const status = document.getElementById('trainingStatus');
            
            // Simulate training process
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Training...';
            
            let progressValue = 0;
            const interval = setInterval(() => {
                progressValue += 10;
                progress.style.width = progressValue + '%';
                progress.textContent = progressValue + '%';
                
                if (progressValue >= 100) {
                    clearInterval(interval);
                    btn.disabled = false;
                    btn.innerHTML = '<i class="fas fa-graduation-cap me-2"></i>Train Model';
                    status.textContent = 'Model training completed successfully!';
                    
                    // Show success message
                    showAlert('Model trained successfully with new parameters!', 'success');
                }
            }, 200);
        });
        
        // Prediction form submission
        document.getElementById('predictionForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Get form values
            const location = document.getElementById('prediction_location').value;
            const date = document.getElementById('prediction_date').value;
            const time = document.getElementById('prediction_time').value;
            const temperature = document.getElementById('prediction_temperature').value;
            const cloudCover = document.getElementById('prediction_cloud_cover').value;
            const humidity = document.getElementById('prediction_humidity').value;
            
            if (!location || !date || !time || !temperature) {
                showAlert('Please fill in all required fields', 'warning');
                return;
            }
            
            // Simulate prediction calculation
            const baseEnergy = 4.2; // Base energy in kWh
            const tempEffect = (temperature - 25) * -0.005; // -0.5% per °C above 25
            const cloudEffect = (cloudCover / 100) * -0.8; // -80% at full cloud cover
            const humidityEffect = (humidity - 50) * 0.001; // Minor humidity effect
            
            const mlPrediction = baseEnergy * (1 + tempEffect + cloudEffect + humidityEffect);
            const pvwattsPrediction = baseEnergy * 0.95; // PVWatts typically slightly conservative
            const hybridPrediction = (mlPrediction + pvwattsPrediction) / 2;
            
            // Display results
            displayPredictionResults(mlPrediction, pvwattsPrediction, hybridPrediction);
        });
        
        // Batch prediction form
        document.getElementById('batchPredictionForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const fileInput = document.getElementById('batchFile');
            
            if (!fileInput.files.length) {
                showAlert('Please select a CSV file to upload', 'warning');
                return;
            }
            
            // Simulate batch processing
            showAlert('Batch prediction started...', 'info');
            setTimeout(() => {
                displayBatchResults();
            }, 2000);
        });
        
        function displayPredictionResults(mlPred, pvwattsPred, hybridPred) {
            const resultsDiv = document.getElementById('predictionResults');
            const template = document.getElementById('resultsTemplate');
            
            // Clone the template
            const resultsContent = template.cloneNode(true);
            resultsContent.classList.remove('d-none');
            
            // Update values
            resultsContent.querySelector('#resultEnergy').textContent = hybridPred.toFixed(2);
            resultsContent.querySelector('#resultConfidence').textContent = '92%';
            
            resultsContent.querySelector('#pvwattsPred').textContent = pvwattsPred.toFixed(2) + ' kWh';
            resultsContent.querySelector('#pvwattsVar').textContent = '±5%';
            
            resultsContent.querySelector('#mlPred').textContent = mlPred.toFixed(2) + ' kWh';
            resultsContent.querySelector('#mlVar').textContent = '±8%';
            
            resultsContent.querySelector('#hybridPred').innerHTML = '<strong>' + hybridPred.toFixed(2) + ' kWh</strong>';
            resultsContent.querySelector('#hybridVar').innerHTML = '<strong>±4%</strong>';
            
            // Generate insight
            const insightText = resultsContent.querySelector('#insightText');
            if (mlPred > pvwattsPred) {
                insightText.textContent = 'ML predicts higher production due to favorable environmental conditions.';
            } else {
                insightText.textContent = 'PVWatts predicts higher production, suggesting conservative ML estimates.';
            }
            
            // Replace content
            resultsDiv.innerHTML = '';
            resultsDiv.appendChild(resultsContent);
        }
        
        function displayBatchResults() {
            const resultsDiv = document.getElementById('batchResults');
            const template = document.getElementById('batchResultsTemplate');
            
            const resultsContent = template.cloneNode(true);
            resultsContent.classList.remove('d-none');
            
            // Populate sample data
            const tbody = resultsContent.querySelector('#batchResultsBody');
            const sampleData = [
                { time: '2024-01-01 08:00', pvwatts: 3.2, ml: 3.5, hybrid: 3.35, confidence: '89%' },
                { time: '2024-01-01 09:00', pvwatts: 4.1, ml: 4.3, hybrid: 4.2, confidence: '92%' },
                { time: '2024-01-01 10:00', pvwatts: 4.8, ml: 5.1, hybrid: 4.95, confidence: '95%' },
                { time: '2024-01-01 11:00', pvwatts: 5.2, ml: 5.4, hybrid: 5.3, confidence: '94%' },
                { time: '2024-01-01 12:00', pvwatts: 5.3, ml: 5.6, hybrid: 5.45, confidence: '96%' }
            ];
            
            sampleData.forEach(row => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${row.time}</td>
                    <td>${row.pvwatts} kWh</td>
                    <td>${row.ml} kWh</td>
                    <td><strong>${row.hybrid} kWh</strong></td>
                    <td><span class="badge bg-success">${row.confidence}</span></td>
                `;
                tbody.appendChild(tr);
            });
            
            resultsDiv.innerHTML = '';
            resultsDiv.appendChild(resultsContent);
            showAlert('Batch prediction completed! 24 hours of data processed.', 'success');
        }
        
        function showAlert(message, type) {
            // Create and show Bootstrap alert
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            // Add to page (you might want to create a specific container for alerts)
            document.querySelector('.container-fluid').insertBefore(alertDiv, document.querySelector('.container-fluid').firstChild);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (alertDiv.parentElement) {
                    alertDiv.remove();
                }
            }, 5000);
        }
    });
        </script>
        <!-- Footer Start -->
        <div class="container-fluid pt-4 px-4">
            <div class="bg-secondary rounded-top p-4">
                <div class="row">
                    <div class="col-12 col-sm-6 text-center text-sm-start">
                        &copy; <a href="#">Solarize Solar Forecasting</a>, All Rights Reserved.
                    </div>
                    <div class="col-12 col-sm-6 text-center text-sm-end">AI-Powered Solar Energy Predictions</div>
                </div>
            </div>
        </div>
        <!-- Footer End -->
    </div>
    <!-- Content End -->
{% endblock %}
