{% extends 'analytics/main.html' %}
{% load static %}

{% block main %}

<!-- Content Start -->
<div class="content">
    <!-- Navbar Start -->
    {% include 'analytics/nav.html' %}
    <!-- Navbar End -->


    <div class="container-fluid px-4">
        <!-- Header -->
        <div class="row mb-3 mt-3 px-2">
            <div class="col-12 card shadow-sm bg-secondary">
                <h1 class="h3 text-primary my-3"><i class="fas fa-thumbtack me-2"></i>Fixed Mount Photovoltaic System Simulation</h1>
                <p class="text-muted small">Fixed mount systems are stationary solar arrays that maintain a constant orientation toward the sky throughout their operational lifetime. These systems represent the most common and cost-effective approach to solar energy generation, particularly for commercial rooftops, residential installations, and utility-scale projects where simplicity and reliability are paramount. This simulation encompasses the complete energy production lifecycle from solar irradiance capture to electrical power conversion, accounting for geographic location, local climate patterns, and specific system configuration parameters.</p>
                
                <p class="text-muted small">This simulation walks you through the complete energy production process, from capturing sunlight to converting it into usable electricity. It considers your specific geographic location, local weather patterns, and the exact configuration of your system to give you a realistic picture of what to expect. It also incorporates temperature-dependent efficiency losses, soiling impacts, and system availability factors to generate realistic production estimates.</p>
            </div>
        </div>
        <!-- Compact Form Layout -->
        <form method="post" class="row g-3" enctype="multipart/form-data">
            {% csrf_token %}
            <!-- Location Parameters -->
            <div class="col-lg-4">
                <div class="card shadow-sm h-100 bg-secondary p-3">
                    <div class="">
                        <h6 class="mb-0 text-warning px-3"></i>Location</h6>
                    </div>

                    <div class="card-body">
                        <div class="row g-2">
                            <div class="col-6">
                                <label class="form-label small">Latitude</label>
                                <input type="number" class="form-control form-control-sm" name="lat" value="-1.286389" step="any">
                            </div>
                            <div class="col-6">
                                <label class="form-label small">Longitude</label>
                                <input type="number" class="form-control form-control-sm" name="lon" value="36.817223" step="any">
                            </div>
                            <div class="col-6">
                                <label class="form-label small">Altitude (m)</label>
                                <input type="number" class="form-control form-control-sm" name="alt" value="0" step="any">
                            </div>
                            <div class="col-6">
                                <label class="form-label small">Timezone</label>
                                <select class="form-select form-select-sm" name="tz">
                                    <option selected value="Africa/Nairobi">Africa/Nairobi</option>
                                    <option>UTC</option>
                                </select>
                            </div>
                            <div class="col-12">
                                <label class="form-label small">Location/Simulation Name</label>
                                <input type="text" class="form-control form-control-sm" name="name" value="Nairobi">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- System Configuration -->
            <div class="col-lg-4">
                <div class="card shadow-sm h-100 bg-secondary p-3">
                    <div class="">
                        <h6 class="mb-0 text-warning px-3">System Configuration</h6>
                    </div>
                    <div class="card-body p-3">
                        <div class="row g-2">
                            <div class="col-6">
                                <label class="form-label small">PV Module</label>
                                <input 
                                    type="text" 
                                    id="module-input" 
                                    name="module" 
                                    list="module-list"
                                    autocomplete="off"
                                    class="form-control form-control-sm"
                                    placeholder="Type to search..."
                                >
                                <datalist id="module-list"></datalist>
                            </div>
                            <div class="col-6">
                                <label class="form-label small">Module Type</label>
                                <select class="form-select form-select-sm" name="module_type">
                                    <option value="glass_polymer" selected>Glass Polymer</option>
                                    <option value="glass_glass">Glass Glass</option>
                                </select>
                            </div>
                            <div class="col-6">
                                <label class="form-label small">Inverter</label>
                                <input 
                                    type="text" 
                                    id="inverter-input" 
                                    name="inverter" 
                                    list="inverter-list"
                                    autocomplete="off"
                                    class="form-control form-control-sm"
                                    placeholder="Type to search..."
                                >
                                <datalist id="inverter-list"></datalist>
                            </div>
                            <div class="col-6">
                                <label class="form-label small">Albedo</label>
                                <input type="number" name="albedo" class="form-control form-control-sm" value="0.25">
                            </div>
                            <div class="col-6">
                                <label class="form-label small">Azimuth (°)</label>
                                <input type="number" class="form-control form-control-sm" name="azimuth" value="180" min="0" max="360">
                            </div>
                            <div class="col-6">
                                <label class="form-label small">Tilt Angle (°)</label>
                                <input type="number" class="form-control form-control-sm" name="tilt" value="20" min="0" max="90">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Array Configuration -->
            <div class="col-lg-4">
                <div class="card shadow-sm h-100 bg-secondary p-3">
                    <div class="">
                        <h6 class="mb-0 text-warning px-3">Array Configuration</h6>
                    </div>
                    <div class="card-body p-3">
                        <div class="row g-2">
                            <div class="col-4">
                                <label class="form-label small">Modules per String</label>
                                <input type="number" name="modules_per_string" class="form-control form-control-sm" value="1">
                            </div>
                            <div class="col-4">
                                <label class="form-label small">Number of Strings</label>
                                <input type="number" name="strings" class="form-control form-control-sm" value="1">
                            </div>
                            <div class="col-4">
                              <label for="arrays_json" class="form-label small mb-1">Extra Arrays</label>
                              <div class="input-group">
                                <label class="btn btn-warning btn-sm mb-0" for="arrays_json">
                                  <i class="fas fa-bolt me-1"></i> <span id="file-name">Upload JSON file</span>
                                </label>
                                <input id="arrays_json" type="file" name="arrays_json" class="d-none" accept=".json">
                              </div>
                            </div>
                            <div class="col-12">
                                <label class="form-label small">System Description</label>
                                <textarea class="form-control" placeholder="Short system description" name="description" style="height: 100px;"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Loss Parameters -->
            <div class="col-lg-8">
                <div class="card shadow-sm h-100 bg-secondary p-4">
                    <div class="">
                        <h6 class="mb-0 text-warning px-3">Loss Parameters (%)</h6>
                    </div>
                    <div class="card-body p-3">
                        <div class="row g-2">
                            <!-- Soiling -->
                            <div class="col-6">
                                <label class="form-label small">Soiling</label>
                                <input type="range" class="form-range" name="soiling" value="2" min="0" max="10" step="0.5" oninput="updateValue(this)">
                                <div class="small text-center"><span>2</span>%</div>
                            </div>

                            <!-- Shading -->
                            <div class="col-6">
                                <label class="form-label small">Shading</label>
                                <input type="range" class="form-range" name="shading" value="3" min="0" max="20" step="0.5" oninput="updateValue(this)">
                                <div class="small text-center"><span>3</span>%</div>
                            </div>

                            <!-- Snow -->
                            <div class="col-6">
                                <label class="form-label small">Snow</label>
                                <input type="range" class="form-range" name="snow" value="1" min="0" max="10" step="0.5" oninput="updateValue(this)">
                                <div class="small text-center"><span>1</span>%</div>
                            </div>

                            <!-- Mismatch -->
                            <div class="col-6">
                                <label class="form-label small">Mismatch</label>
                                <input type="range" class="form-range" name="mismatch" value="2" min="0" max="5" step="0.5" oninput="updateValue(this)">
                                <div class="small text-center"><span>2</span>%</div>
                            </div>

                            <!-- Wiring -->
                            <div class="col-6">
                                <label class="form-label small">Wiring</label>
                                <input type="range" class="form-range" name="wiring" value="2" min="0" max="5" step="0.5" oninput="updateValue(this)">
                                <div class="small text-center"><span>2</span>%</div>
                            </div>

                            <!-- Connections -->
                            <div class="col-6">
                                <label class="form-label small">Connections</label>
                                <input type="range" class="form-range" name="connections" value="0.5" min="0" max="3" step="0.1" oninput="updateValue(this)">
                                <div class="small text-center"><span>0.5</span>%</div>
                            </div>

                            <!-- LID -->
                            <div class="col-6">
                                <label class="form-label small">Light-Induced Degradation (LID)</label>
                                <input type="range" class="form-range" name="lid" value="1.5" min="0" max="3" step="0.1" oninput="updateValue(this)">
                                <div class="small text-center"><span>1.5</span>%</div>
                            </div>

                            <!-- Nameplate -->
                            <div class="col-6">
                                <label class="form-label small">Nameplate Rating Tolerance</label>
                                <input type="range" class="form-range" name="nameplate" value="1" min="0" max="5" step="0.5" oninput="updateValue(this)">
                                <div class="small text-center"><span>1</span>%</div>
                            </div>

                            <!-- Age -->
                            <div class="col-6">
                                <label class="form-label small">Module Age/Degradation</label>
                                <input type="range" class="form-range" name="age" value="0.5" min="0" max="10" step="0.1" oninput="updateValue(this)">
                                <div class="small text-center"><span>0.5</span>%</div>
                            </div>

                            <!-- Availability -->
                            <div class="col-6">
                                <label class="form-label small">System Availability</label>
                                <input type="range" class="form-range" name="availability" value="1" min="0" max="5" step="0.5" oninput="updateValue(this)">
                                <div class="small text-center"><span>1</span>%</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Simulation Parameters -->
            <div class="col-lg-4">
                <div class="card shadow-sm h-100 bg-secondary p-3">
                    <div class="">
                        <h6 class="mb-0 text-warning px-3">Simulation Parameters</h6>
                    </div>
                    <div class="card-body p-3">
                        <div class="row g-2">                          
                            <div class="col-6">
                                <label class="form-label small">Start Date</label>
                                <input type="date" class="form-control form-control-sm" name="start_date" value="2023-01-01">
                            </div>
                            <div class="col-6">
                                <label class="form-label small">Temperature Model</label>
                                <select class="form-select form-select-sm" name="temp_model">
                                    <option value="sapm" selected>SAPM</option>
                                    <option value="pvsyst">PVsyst</option>
                                    <option value="faiman">Faiman</option>
                                </select>
                            </div>
                            <div class="col-6">
                                <label class="form-label small">End Date</label>
                                <input type="date" class="form-control form-control-sm" name="end_date" value="2023-12-31">
                            </div>
                            <div class="col-6">
                                <label class="form-label small">Temperature Model Parameters</label>
                                <select class="form-select form-select-sm" name="temp_model_params">
                                    <option value="open_rack_glass_glass" selected>Open Rack - Glass/Glass</option>
                                    <option value="open_rack_glass_polymer">Open Rack - Glass/Polymer</option>
                                    <option value="insulated_back_glass_polymer">Insulated Back - Glass/Polymer</option>
                                    <option value="close_mount_glass_polymer">Close Mount - Glass/Polymer</option>
                                    <option value="roof_mount_glass_polymer">Roof Mount - Glass/Polymer</option>
                                </select>
                            </div>
                            <div class="col-6">
                                <label class="form-label small">Timeframe</label>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="timeframe" value="hourly" checked>
                                    <label class="form-check-label small">Hourly</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="timeframe" value="daily">
                                    <label class="form-check-label small">Daily</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="timeframe" value="monthly">
                                    <label class="form-check-label small">Monthly</label>
                                </div>
                            </div>  
                        </div>
                        <div class="row mt-3">
                            <div class="col-12">
                                <div class="d-flex justify-content-end gap-2">
                                    <button type="button" class="btn btn-outline-primary btn-sm">
                                        <i class="fas fa-redo me-1"></i>Reset
                                    </button>
                                    <button type="submit" class="btn btn-warning btn-sm">
                                        <i class="fas fa-bolt me-1"></i>Run Simulation
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>

        <!-- PVLib Parameters Documentation -->
        <div class="row mt-3">
          <div class="col-12">
            <div class="card shadow-sm bg-secondary text-light">
              <!-- Header -->
              <div class="text-center rounded p-3">
                <div class="d-flex justify-content-between align-items-center">
                  <h6 class="mb-0 text-warning">
                    <i class="fas fa-book me-1"></i> Quick Guide
                  </h6>
                  <button class="btn btn-sm btn-outline-light" type="button" data-bs-toggle="collapse" data-bs-target="#docsCollapse">
                    <i class="fas fa-chevron-down"></i>
                  </button>
                </div>
              </div>

              <!-- Collapsible Section -->
              <div class="collapse show" id="docsCollapse">
                <div class="card-body p-3 bg-secondary">
                  <div class="row g-4">
                    
                    <!-- Location & Site Parameters -->
                    <div class="col-md-6">
                      <h6 class="text-primary mb-2">Location & Site Parameters</h6>
                      <ul class="small ps-3 mb-0">
                        <li><strong>Latitude & Longitude:</strong> Geographic coordinates in decimal degrees (<code>-90°</code> to <code>90°</code> latitude, <code>-180°</code> to <code>180°</code> longitude). Used to compute solar position and irradiance geometry.</li>
                        <li><strong>Altitude:</strong> Elevation above sea level in meters. Affects air mass, atmospheric pressure, and irradiance attenuation.</li>
                        <li><strong>Timezone:</strong> Local timezone (e.g., <code>"Africa/Nairobi"</code>) for proper solar time conversion and daylight saving adjustments.</li>
                        <li><strong>Albedo:</strong> Ground reflectance coefficient (0–1). Typical values: 0.2 for vegetation, 0.25 for dry grass, 0.1 for asphalt, and up to 0.8 for snow.</li>
                      </ul>
                    </div>

                    <!-- System Configuration -->
                    <div class="col-md-6">
                      <h6 class="text-primary mb-2">System Configuration</h6>
                      <ul class="small ps-3 mb-0">
                        <li><strong>Azimuth:</strong> Panel orientation in degrees (<code>0° = North</code>, <code>90° = East</code>, <code>180° = South</code>, <code>270° = West</code>). Optimal azimuth depends on hemisphere and site layout.</li>
                        <li><strong>Tilt Angle:</strong> Inclination of the module surface from horizontal. A tilt equal to site latitude often provides near-optimal annual energy yield.</li>
                        <li><strong>Number of Arrays:</strong> Build multiple PV arrays from combined modules. Each array uses shared mount, albedo, and module characteristics.</li>
                      </ul>
                    </div>

                    <!-- Module Specifications -->
                    <div class="col-md-6">
                        <h6 class="text-primary mb-2">Module Specifications</h6>
                        <ul class="small ps-3 mb-0">
                            <li><strong>Module Type:</strong> Technology category - <code>glass_glass, glass_polymer</code>. Affects performance and temperature coefficients.</li>
                            <li><strong>Modules per String:</strong> Number of modules connected in series. Determines string voltage and must comply with inverter MPPT range.</li>
                            <li><strong>Number of Strings:</strong> Parallel strings in the array. Multiplies current output and affects combiner/breaker sizing.</li>
                        </ul>
                    </div>

                    <!-- System Loss Factors -->
                    <div class="col-md-6">
                      <h6 class="text-primary mb-2">System Loss Factors</h6>
                      <ul class="small ps-3 mb-0">
                        <li><strong>Soiling:</strong> Dust, dirt, or pollen accumulation reducing light transmittance (2–5% typical).</li>
                        <li><strong>Shading:</strong> Obstructions from trees, structures, or self-shading. Highly site-dependent (1–20%).</li>
                        <li><strong>Mismatch:</strong> Module variation in I-V characteristics due to aging or manufacturing tolerances (1–3%).</li>
                        <li><strong>Wiring Losses:</strong> Resistive DC and AC cable losses (1–3%) depending on conductor sizing.</li>
                        <li><strong>Light-Induced Degradation (LID):</strong> Initial power loss in crystalline silicon modules after light exposure (0.5–2%).</li>
                        <li><strong>Availability:</strong> Downtime due to maintenance, inverter faults, or grid outages (1–3%).</li>
                      </ul>
                    </div>

                    <!-- Temperature Modeling -->
                    <div class="col-md-6">
                      <h6 class="text-primary mb-2">Temperature Modeling</h6>
                      <ul class="small ps-3 mb-0">
                        <li><strong>Model Type:</strong> Defines how cell temperature is derived from ambient temperature, irradiance, and wind speed. Common models: <code>SAM</code>, <code>PVsyst</code>, <code>Faiman</code>.</li>
                        <li><strong>Model Parameters:</strong> Include nominal operating cell temperature (NOCT), wind and irradiance coefficients.</li>
                        <li><strong>Effect:</strong> Higher cell temperature reduces module voltage and efficiency; PVLib corrects power accordingly.</li>
                      </ul>
                    </div>

                    <!-- Simulation Parameters -->
                    <div class="col-md-6">
                      <h6 class="text-primary mb-2">Simulation Parameters</h6>
                      <ul class="small ps-3 mb-0">
                        <li><strong>Timeframe & Resolution:</strong> Simulation span (e.g., daily, monthly, or annual) and timestep (e.g., hourly or sub-hourly).</li>
                        <li><strong>Weather Data Source:</strong> Typical Meteorological Year datasets (<code>TMY3</code>, <code>TMY4</code>, <code>EPW</code>) or reanalysis data such as <code>ERA5</code>.</li>
                        <li><strong>Irradiance Model:</strong> Transposition models like <code>Perez</code>, <code>Hay</code>, or <code>Klucher</code> used to convert horizontal to plane-of-array irradiance.</li>
                        <li><strong>Air Mass Model:</strong> Calculates relative optical path length through the atmosphere affecting spectral composition.</li>
                      </ul>
                    </div>
                  </div>

                  <!-- Additional Reference Sections -->
                  <hr class="my-4">

                 <div>
                      <h6 class="text-primary">Solar Modules</h6>
                      <p class="small mb-1">
                        The module database contains detailed specifications for thousands of certified PV modules.
                      </p>
                      <ul class="small ps-3 mb-3">
                        <li><strong>Source:</strong> 
                          <a href="https://raw.githubusercontent.com/NREL/SAM/develop/deploy/libraries/CEC%20Modules.csv">
                            California Energy Commission (CEC) Modules Database from NREL SAM GitHub repository.
                          </a>
                        </li>
                        <li><strong>Format:</strong> CSV database with standardized parameters.</li>
                        <li><strong>Includes:</strong> Electrical ratings, temperature coefficients, physical dimensions, technology type, and manufacturer details.</li>
                      </ul>

                      <h6 class="text-primary">Inverters</h6>
                      <ul class="small ps-3 mb-3">
                        <li><strong>Source:</strong> 
                          <a href="https://raw.githubusercontent.com/NREL/SAM/develop/deploy/libraries/CEC%20Inverters.csv">
                            CEC Inverters Database from SAM GitHub repository.
                          </a>
                        </li>
                        <li><strong>Includes:</strong> Maximum AC/DC power, MPPT voltage range, CEC-weighted efficiency, and night-time parasitic consumption.</li>
                        <li><strong>Format:</strong> CSV file with validated performance data and efficiency curves.</li>
                      </ul>

                      <!-- NEW SECTION -->
                      <h6 class="text-primary">Meteorological Data (PVGIS TMY)</h6>
                      <p class="small mb-1">
                        The solar energy simulations rely on high-resolution climate and irradiance data provided by the 
                        <strong>Photovoltaic Geographical Information System (PVGIS)</strong> developed by the European Commission’s Joint Research Centre (JRC).
                      </p>
                      <ul class="small ps-3 mb-3">
                        <li><strong>Source:</strong> 
                          <a href="https://joint-research-centre.ec.europa.eu/pvgis_en" target="_blank">
                            PVGIS Typical Meteorological Year (TMY) Dataset.
                          </a>
                        </li>
                        <li><strong>Purpose:</strong> Provides long-term averaged hourly solar irradiance, temperature, and wind data for realistic PV performance simulations.</li>
                        <li><strong>Coverage:</strong> Global dataset with regional accuracy adjustments based on satellite and ground-station measurements.</li>
                        <li><strong>Usage:</strong> PVLib uses this data to compute irradiance, cell temperature, and energy yield under site-specific conditions.</li>
                      </ul>
                      <div class="alert alert-warning small mt-3 mb-0">
                        <i class="bi bi-info-circle"></i>
                        <strong>Current Data Sources:</strong> 
                        This simulation uses official CEC module and inverter databases maintained by NREL’s System Advisor Model (SAM) project, 
                        combined with PVGIS TMY meteorological data for realistic energy yield estimation.
                      </div>

                      <div class="mt-3 small text-muted">
                        <strong>Important Notes:</strong>
                        <ul class="ps-3 mb-0">
                          <li>Databases are optimized for North American certified products.</li>
                          <li>PVGIS ensures accurate solar resource data for global locations.</li>
                          <li>All datasets are updated periodically to reflect current conditions and certifications.</li>
                          <li>Standardized parameters ensure PVLib compatibility and reproducible modeling.</li>
                          <li>Future releases may include additional regional datasets for expanded global coverage.</li>
                        </ul>
                      </div>
                    </div>


                </div>
              </div>
            </div>
          </div>
        </div>




    <!-- Footer Start -->
    <div class="container-fluid pt-4 px-4">
        <div class="bg-secondary rounded-top p-4">
            <div class="row">
                <div class="col-12 col-sm-6 text-center text-sm-start">
                    &copy; <a href="#">Solarize Solar Forecasting</a>, All Rights Reserved. 
                </div>
                <div class="col-12 col-sm-6 text-center text-sm-end">
                    AI-Powered Solar Energy Predictions
                </div>
            </div>
        </div>
    </div>
    <!-- Footer End -->
</div>
<!-- Content End -->


{% endblock %}