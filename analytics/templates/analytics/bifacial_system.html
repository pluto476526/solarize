{% extends 'analytics/main.html' %}
{% load static %}
{% block main %}
    <!-- Content Start -->
    <div class="content">
        <!-- Navbar Start -->
        {% include 'analytics/nav.html' %}
        <!-- Navbar End -->
        <div class="container-fluid px-3">
            <!-- Header -->
            <div class="row mb-3 mt-3 px-2">
                <div class="col-12 card shadow-sm bg-secondary">
                    <h1 class="h3 text-primary my-3">
                        <i class="fas fa-layer-group me-2"></i>Bifacial Photovoltaic System Simulation
                    </h1>
                    <p class="text-muted small">
                        Bifacial photovoltaic system simulation models the unique energy harvesting capabilities of double-sided solar modules that capture light from both front and rear surfaces. This advanced technology leverages albedo reflection from ground surfaces and structural elements to generate additional energy beyond traditional monofacial systems. Bifacial simulation requires sophisticated modeling of complex optical interactions between module geometry, mounting configuration, ground conditions, and atmospheric scattering effects that influence rear-side irradiance capture.
                    </p>
                    <p class="text-muted small">
                        PVLib approaches bifacial simulation through advanced ray-tracing and view factor algorithms that calculate the additional irradiance reaching the rear module surface from reflected and diffuse light sources. The library models the optical properties of different ground surfaces through albedo parameters that range from low-reflectance vegetation to high-reflectance concrete or specialized reflective materials. PVLib incorporates system geometry factors including mounting height, row spacing, tilt angle, and module arrangement to determine the view factor between rear surfaces and reflective areas. The simulation accounts for spectral effects and angular response characteristics that differ between front and rear surfaces due to typical bifacial cell architecture and encapsulation materials.
                    </p>
                    <p class="text-muted small">
                        The comprehensive bifacial system simulation delivers crucial insights for determining when the technology premium translates to sufficient energy gain to justify additional costs. Project developers can optimize system design parameters such as mounting height and row spacing to maximize rear-side energy capture while minimizing balance-of-system expenses. Installation teams benefit from understanding how different ground treatments and maintenance practices affect long-term albedo and resulting energy production. The simulation also helps identify applications where bifacial technology provides particular advantages, such as elevated structures, snowy environments, or installations with high-reflectance surfaces, enabling targeted deployment where the technology delivers maximum value.
                    </p>
                </div>
            </div>
            <!-- Compact Form Layout -->
            <form method="post" class="row g-3" enctype="multipart/form-data">
                {% csrf_token %}
                <!-- Location Parameters -->
                <div class="col-lg-4">
                    <div class="card shadow-sm h-100 bg-secondary p-3">
                        <div class="">
                            <h6 class="mb-0 text-warning px-3">
                            </i>Location
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="row g-2">
                            <div class="col-6">
                                <label class="form-label small">Latitude</label>
                                <input type="number"
                                       class="form-control form-control-sm"
                                       name="lat"
                                       value="-1.286389"
                                       step="any">
                            </div>
                            <div class="col-6">
                                <label class="form-label small">Longitude</label>
                                <input type="number"
                                       class="form-control form-control-sm"
                                       name="lon"
                                       value="36.817223"
                                       step="any">
                            </div>
                            <div class="col-4">
                                <label class="form-label small">Altitude (m)</label>
                                <input type="number"
                                       class="form-control form-control-sm"
                                       name="alt"
                                       value="0"
                                       step="any">
                            </div>
                            <div class="col-4">
                                <label class="form-label small">Albedo</label>
                                <input type="number"
                                       name="albedo"
                                       class="form-control form-control-sm"
                                       value="0.25">
                            </div>
                            <div class="col-4">
                                <label class="form-label small">Timezone</label>
                                <select class="form-select form-select-sm" name="tz">
                                    <option selected value="Africa/Nairobi">Africa/Nairobi</option>
                                    <option>UTC</option>
                                </select>
                            </div>
                            <div class="col-12">
                                <label class="form-label small">Location/Simulation Name</label>
                                <input type="text"
                                       class="form-control form-control-sm"
                                       name="name"
                                       value="Nairobi">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- System Configuration -->
            <div class="col-lg-4">
                <div class="card shadow-sm h-100 bg-secondary p-3">
                    <div class="">
                        <h6 class="mb-0 text-warning px-3">System Configuration</h6>
                    </div>
                    <div class="card-body p-3">
                        <div class="row g-2">
                            <div class="col-12">
                                <label class="form-label small">PV Module</label>
                                <input type="text"
                                       id="module-input"
                                       name="module"
                                       list="module-list"
                                       autocomplete="off"
                                       class="form-control form-control-sm"
                                       placeholder="Type to search...">
                                <datalist id="module-list"></datalist>
                            </div>
                            <div class="col-12">
                                <label class="form-label small">Inverter</label>
                                <input type="text"
                                       id="inverter-input"
                                       name="inverter"
                                       list="inverter-list"
                                       autocomplete="off"
                                       class="form-control form-control-sm"
                                       placeholder="Type to search...">
                                <datalist id="inverter-list"></datalist>
                            </div>
                            <div class="col-4">
                                <label class="form-label small">Module Type</label>
                                <select class="form-select form-select-sm" name="module_type">
                                    <option value="glass_polymer" selected>Glass Polymer</option>
                                    <option value="glass_glass">Glass Glass</option>
                                </select>
                            </div>
                            <div class="col-4">
                                <label class="form-label small">Surface Azimuth (°)</label>
                                <input type="number"
                                       name="azimuth"
                                       class="form-control form-control-sm"
                                       value="180">
                            </div>
                            <div class="col-4">
                                <label class="form-label small">Surface Tilt (°)</label>
                                <input type="number"
                                       name="tilt"
                                       class="form-control form-control-sm"
                                       value="20">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Array Configuration -->
            <div class="col-lg-4">
                <div class="card shadow-sm h-100 bg-secondary p-3">
                    <div class="">
                        <h6 class="mb-0 text-warning px-3">Array Configuration</h6>
                    </div>
                    <div class="card-body p-3">
                        <div class="row g-2">
                            <div class="col-4">
                                <label class="form-label small">Modules per String</label>
                                <input type="number"
                                       name="modules_per_string"
                                       class="form-control form-control-sm"
                                       value="1">
                            </div>
                            <div class="col-4">
                                <label class="form-label small">Number of Strings</label>
                                <input type="number"
                                       name="strings"
                                       class="form-control form-control-sm"
                                       value="1">
                            </div>
                            <div class="col-4">
                                <label for="file-input" class="form-label small mb-1">Extra Arrays</label>
                                <div class="input-group">
                                    <label class="btn btn-warning btn-sm mb-0" for="file-input">
                                        <i class="fas fa-bolt me-1"></i> <span id="file-name">Upload JSON file</span>
                                    </label>
                                    <input id="file-input"
                                           type="file"
                                           name="arrays_json"
                                           class="d-none"
                                           accept=".json">
                                </div>
                            </div>
                            <div class="col-12">
                                <label class="form-label small">System Description</label>
                                <textarea class="form-control"
                                          placeholder="Short system description"
                                          name="description"
                                          style="height: 100px"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Bifacial Configuration -->
            <div class="col-lg-4">
                <div class="card shadow-sm h-100 bg-secondary p-3">
                    <h6 class="mb-3 text-warning px-2">Bifacial Configuration</h6>
                    <div class="card-body p-2">
                        <div class="row g-2">
                            <!-- Bifaciality -->
                            <div class="col-12">
                                <label class="form-label small">Bifaciality</label>
                                <input type="number"
                                       class="form-control form-control-sm"
                                       name="bifaciality"
                                       value="0.75"
                                       min="0"
                                       max="1"
                                       step="0.01"
                                       required>
                            </div>
                            <!-- Ground Coverage Ratio -->
                            <div class="col-6">
                                <label class="form-label small">Ground Coverage Ratio (GCR)</label>
                                <input type="number"
                                       class="form-control form-control-sm"
                                       name="gcr"
                                       value="0.4"
                                       min="0"
                                       max="1"
                                       step="0.01"
                                       required>
                            </div>
                            <!-- PV Row Height -->
                            <div class="col-6">
                                <label class="form-label small">PV Row Height (m)</label>
                                <input type="number"
                                       class="form-control form-control-sm"
                                       name="pvrow_height"
                                       value="1.0"
                                       min="0"
                                       step="0.01"
                                       required>
                            </div>
                            <!-- PV Row Width -->
                            <div class="col-6">
                                <label class="form-label small">PV Row Width (m)</label>
                                <input type="number"
                                       class="form-control form-control-sm"
                                       name="pvrow_width"
                                       value="2.0"
                                       min="0"
                                       step="0.01"
                                       required>
                            </div>
                            <!-- Number of PV Rows -->
                            <div class="col-6">
                                <label class="form-label small">Number of PV Rows</label>
                                <input type="number"
                                       class="form-control form-control-sm"
                                       name="n_pvrows"
                                       value="3"
                                       min="1"
                                       step="1"
                                       required>
                            </div>
                            <!-- Observed PV Row Index -->
                            <div class="col-6">
                                <label class="form-label small">Observed PV Row Index</label>
                                <input type="number"
                                       class="form-control form-control-sm"
                                       name="index_observed_pvrow"
                                       value="1"
                                       min="0"
                                       step="1"
                                       required>
                            </div>
                            <!-- Front Reflectivity -->
                            <div class="col-6">
                                <label class="form-label small">
                                    Front Surface Reflectivity (ρ<sub>front</sub>)
                                </label>
                                <input type="number"
                                       class="form-control form-control-sm"
                                       name="rho_front_pvrow"
                                       value="0.03"
                                       min="0"
                                       max="1"
                                       step="0.01"
                                       required>
                            </div>
                            <!-- Back Reflectivity -->
                            <div class="col-6">
                                <label class="form-label small">
                                    Back Surface Reflectivity (ρ<sub>back</sub>)
                                </label>
                                <input type="number"
                                       class="form-control form-control-sm"
                                       name="rho_back_pvrow"
                                       value="0.05"
                                       min="0"
                                       max="1"
                                       step="0.01"
                                       required>
                            </div>
                            <!-- Horizon Band Angle -->
                            <div class="col-6">
                                <label class="form-label small">Horizon Band Angle (°)</label>
                                <input type="number"
                                       class="form-control form-control-sm"
                                       name="horizon_band_angle"
                                       value="15"
                                       min="0"
                                       max="90"
                                       step="0.1"
                                       required>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Loss Parameters -->
            <div class="col-lg-4">
                <div class="card shadow-sm h-100 bg-secondary p-3">
                    <div class="">
                        <h6 class="mb-0 text-warning px-3">System Loss Parameters (%)</h6>
                    </div>
                    <div class="card-body p-3">
                        <div class="row g-2">
                            <div class="col-6">
                                <label class="form-label small">Soiling Losses</label>
                                <input type="number"
                                       class="form-control form-control-sm"
                                       name="soiling"
                                       value="2"
                                       min="0"
                                       max="100"
                                       step="0.1">
                            </div>
                            <div class="col-6">
                                <label class="form-label small">Shading Losses</label>
                                <input type="number"
                                       class="form-control form-control-sm"
                                       name="shading"
                                       value="3"
                                       min="0"
                                       max="100"
                                       step="0.1">
                            </div>
                            <div class="col-6">
                                <label class="form-label small">Snow Coverage Losses</label>
                                <input type="number"
                                       class="form-control form-control-sm"
                                       name="snow"
                                       value="0"
                                       min="0"
                                       max="100"
                                       step="0.1">
                            </div>
                            <div class="col-6">
                                <label class="form-label small">Module Mismatch Losses</label>
                                <input type="number"
                                       class="form-control form-control-sm"
                                       name="mismatch"
                                       value="2"
                                       min="0"
                                       max="100"
                                       step="0.1">
                            </div>
                            <div class="col-6">
                                <label class="form-label small">Wiring Losses</label>
                                <input type="number"
                                       class="form-control form-control-sm"
                                       name="wiring"
                                       value="2"
                                       min="0"
                                       max="100"
                                       step="0.1">
                            </div>
                            <div class="col-6">
                                <label class="form-label small">Connection Losses</label>
                                <input type="number"
                                       class="form-control form-control-sm"
                                       name="connections"
                                       value="0.5"
                                       min="0"
                                       max="100"
                                       step="0.1">
                            </div>
                            <div class="col-6">
                                <label class="form-label small">Light Induced Degradation (LID)</label>
                                <input type="number"
                                       class="form-control form-control-sm"
                                       name="lid"
                                       value="1.5"
                                       min="0"
                                       max="100"
                                       step="0.1">
                            </div>
                            <div class="col-6">
                                <label class="form-label small">Nameplate Rating Losses</label>
                                <input type="number"
                                       class="form-control form-control-sm"
                                       name="nameplate"
                                       value="1"
                                       min="0"
                                       max="100"
                                       step="0.1">
                            </div>
                            <div class="col-6">
                                <label class="form-label small">Age Related Degradation</label>
                                <input type="number"
                                       class="form-control form-control-sm"
                                       name="age"
                                       value="0.5"
                                       min="0"
                                       max="100"
                                       step="0.1">
                            </div>
                            <div class="col-6">
                                <label class="form-label small">System Availability</label>
                                <input type="number"
                                       class="form-control form-control-sm"
                                       name="availability"
                                       value="98"
                                       min="0"
                                       max="100"
                                       step="0.1">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Simulation Parameters -->
            <div class="col-lg-4">
                <div class="card shadow-sm h-100 bg-secondary p-3">
                    <div class="">
                        <h6 class="mb-0 text-warning px-3">Simulation Parameters</h6>
                    </div>
                    <div class="card-body p-3">
                        <div class="row g-2">
                            <div class="col-6">
                                <label class="form-label small">Temperature Model</label>
                                <select class="form-select form-select-sm" name="temp_model">
                                    <option value="sapm" selected>SAPM</option>
                                    <option value="pvsyst">PVsyst</option>
                                    <option value="faiman">Faiman</option>
                                </select>
                            </div>
                            <div class="col-6">
                                <label class="form-label small">Temperature Model Parameters</label>
                                <select class="form-select form-select-sm" name="temp_model_params">
                                    <option value="open_rack_glass_glass" selected>Open Rack - Glass/Glass</option>
                                    <option value="open_rack_glass_polymer">Open Rack - Glass/Polymer</option>
                                    <option value="insulated_back_glass_polymer">Insulated Back - Glass/Polymer</option>
                                    <option value="close_mount_glass_polymer">Close Mount - Glass/Polymer</option>
                                    <option value="roof_mount_glass_polymer">Roof Mount - Glass/Polymer</option>
                                </select>
                            </div>
                            <div class="col-12">
                                <label class="form-label small">Weather Data</label>
                                <select class="form-select form-select-sm" name="data_source">
                                    <option value="pvgis" selected>PVGIS – European & African TMY</option>
                                    <option value="nasa">NASA POWER – Global Prediction</option>
                                </select>
                            </div>
                            <div class="col-12">
                                <label class="form-label small">Simulation Output Year</label>
                                <input type="number"
                                       class="form-control form-control-sm"
                                       name="year"
                                       value="2025"
                                       step="1">
                                <small class="text-muted d-block mt-1">This date determines the year for your simulation results, not the data source period.</small>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-12">
                                <div class="d-flex justify-content-end gap-2">
                                    <button type="button" class="btn btn-outline-primary btn-sm">
                                        <i class="fas fa-redo me-1"></i>Reset
                                    </button>
                                    <button type="submit" class="btn btn-warning btn-sm">
                                        <i class="fas fa-bolt me-1"></i>Run Simulation
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>
        <!-- Compact Documentation -->
        <div class="row mt-3">
            <div class="col-12">
                <div class="card shadow-sm bg-secondary">
                    <div class="text-center rounded p-3">
                        <div class="d-flex justify-content-between align-items-center">
                            <h6 class="mb-0 text-warning px-3">
                                <i class="fas fa-book me-1"></i>PVLib Parameters Documentation
                            </h6>
                            <button class="btn btn-sm btn-outline-light"
                                    type="button"
                                    data-bs-toggle="collapse"
                                    data-bs-target="#docsCollapse">
                                <i class="fas fa-chevron-down"></i>
                            </button>
                        </div>
                    </div>
                    <div class="collapse show" id="docsCollapse">
                        <div class="card-body p-3">
                            <div class="row g-3">
                                <div class="col-md-4">
                                    <h6 class="text-primary">Location Parameters</h6>
                                    <ul class="small ps-3">
                                        <li>
                                            <strong>Latitude & Longitude:</strong> Geographic coordinates in decimal degrees
                                        </li>
                                        <li>
                                            <strong>Altitude:</strong> Elevation above sea level in meters
                                        </li>
                                        <li>
                                            <strong>Timezone:</strong> Local timezone for proper time alignment
                                        </li>
                                    </ul>
                                </div>
                                <div class="col-md-4">
                                    <h6 class="text-primary">System Configuration</h6>
                                    <ul class="small ps-3">
                                        <li>
                                            <strong>Capacity:</strong> Total DC power rating in kW
                                        </li>
                                        <li>
                                            <strong>Azimuth:</strong> Panel direction (0°=North, 180°=South)
                                        </li>
                                        <li>
                                            <strong>Tilt:</strong> Panel inclination from horizontal
                                        </li>
                                        <li>
                                            <strong>Array Type:</strong> Mounting configuration
                                        </li>
                                    </ul>
                                </div>
                                <div class="col-md-4">
                                    <h6 class="text-primary">Loss Parameters</h6>
                                    <ul class="small ps-3">
                                        <li>
                                            <strong>Soiling:</strong> Dirt/dust on panels (2-5%)
                                        </li>
                                        <li>
                                            <strong>Shading:</strong> Shadows from nearby objects
                                        </li>
                                        <li>
                                            <strong>Mismatch:</strong> Electrical mismatch between modules
                                        </li>
                                        <li>
                                            <strong>Wiring:</strong> Resistance losses (1-3%)
                                        </li>
                                    </ul>
                                </div>
                                <div class="col-md-4">
                                    <h6 class="text-primary">Temperature</h6>
                                    <ul class="small ps-3">
                                        <li>
                                            <strong>Temp Model:</strong> Algorithm for module temperature
                                        </li>
                                        <li>
                                            <strong>Wind Speed:</strong> For convective cooling calculations
                                        </li>
                                    </ul>
                                </div>
                                <div class="col-md-4">
                                    <h6 class="text-primary">Simulation</h6>
                                    <ul class="small ps-3">
                                        <li>
                                            <strong>Timeframe:</strong> Resolution of results
                                        </li>
                                        <li>
                                            <strong>Weather Data:</strong> Source of meteorological data
                                        </li>
                                        <li>
                                            <strong>Albedo:</strong> Ground reflectance coefficient
                                        </li>
                                    </ul>
                                </div>
                                <div class="col-md-4">
                                    <h6 class="text-primary">Module Types</h6>
                                    <ul class="small ps-3">
                                        <li>
                                            <strong>Standard:</strong> Typical silicon (15-17% efficiency)
                                        </li>
                                        <li>
                                            <strong>Premium:</strong> High-efficiency (19-22%)
                                        </li>
                                        <li>
                                            <strong>Thin Film:</strong> Lightweight (10-13%)
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% include 'analytics/footer.html' %}
</div>
<!-- Content End -->
{% endblock %}
